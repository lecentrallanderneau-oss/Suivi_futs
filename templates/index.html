{% extends "base.html" %}
{% import "_macros.html" as ui %}

{% block content %}
<div class="header-line">
  <h1>Stock par client</h1>
  <a class="btn btn-primary" href="{{ url_for('movement_new') }}">+ Saisie</a>
</div>
<hr>

{# Alerte réassort #}
{{ ui.alerts_list(alerts) }}

<div class="list-rows">
  {% for c in cards %}
    {# Valeurs sûres #}
    {% set beer_eur = c.beer_eur or 0 %}
    {% set deposit_keg_eur = c.deposit_eur or 0 %}
    {% set deposit_cup_eur = c.deposit_cup_eur or 0 %}
    {% set eq = c.equipment or {} %}
    {% set t = eq.tireuse or 0 %}
    {% set co2 = eq.co2 or 0 %}
    {% set comptoir = eq.comptoir or 0 %}
    {% set tonnelle = eq.tonnelle or 0 %}

    <div class="list-row">
      <div class="col-name">
        <a class="client-link" href="{{ url_for('client_detail', client_id=c.id) }}">{{ c.name }}</a>
      </div>

      <div class="col-pills">
        <span class="pill">fût(s)</span>
        <span class="pill">Bière facturée: {{ "%.2f"|format(beer_eur) }} €</span>
        <span class="pill">Consignes fûts: {{ "%.2f"|format(deposit_keg_eur) }} €</span>
        <span class="pill pill-cup">Consigne gobelets: {{ "%.2f"|format(deposit_cup_eur) }} €</span>
      </div>

      <div class="col-eq">
        {% set parts = [] %}
        {% if t > 0 %}{% set _ = parts.append("Tireuse × " ~ t) %}{% endif %}
        {% if co2 > 0 %}{% set _ = parts.append("CO₂ × " ~ co2) %}{% endif %}
        {% if comptoir > 0 %}{% set _ = parts.append("Comptoir × " ~ comptoir) %}{% endif %}
        {% if tonnelle > 0 %}{% set _ = parts.append("Tonnelle × " ~ tonnelle) %}{% endif %}
        {% if parts|length == 0 %}
          <span class="muted">Aucun matériel en prêt</span>
        {% else %}
          {{ parts|join(", ") }}
        {% endif %}
      </div>
    </div>
  {% endfor %}
</div>
{% endblock %}
