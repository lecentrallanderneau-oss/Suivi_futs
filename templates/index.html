{% extends "base.html" %}
{% import "_macros.html" as ui %}

{% block content %}
  <section class="hero">
    <h1>Suivi fÃ»ts</h1>
    <p class="muted">Tableau de bord</p>
  </section>

  <section class="bubbles">
    <h2>ðŸŽ¯ Aujourdâ€™hui</h2>
    {% if day_movements and day_movements|length %}
      <ul class="bubble-row">
        {% for m in day_movements %}
          <li class="bubble">
            <div class="bubble-type {{ 'is-delivery' if m.movement_type == 'delivery' else 'is-return' }}">
              {{ 'Livraison' if m.movement_type == 'delivery' else 'Reprise' }}
            </div>
            <div class="bubble-body">
              <div class="bubble-title">
                <a href="{{ url_for('client_detail', client_id=m.client_id) }}">
                  {{ m.client.name if m.client and (m.client.name is defined) else ('Client #' ~ m.client_id) }}
                </a>
              </div>
              <div class="bubble-meta">
                {{ (m.qty or 0) }} Ã— {{ m.product or 'â€”' }}
                {% if m.keg_serial %} â€¢ FÃ»t {{ m.keg_serial }}{% endif %}
              </div>
              <div class="bubble-time">
                {{ m.created_at }}
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">Aucun mouvement saisi aujourdâ€™hui.</p>
    {% endif %}
  </section>

  <section class="bubbles">
    <h2>ðŸ•˜ Derniers mouvements</h2>
    {% if recent_movements and recent_movements|length %}
      <ul class="bubble-row">
        {% for m in recent_movements %}
          <li class="bubble">
            <div class="bubble-type {{ 'is-delivery' if m.movement_type == 'delivery' else 'is-return' }}">
              {{ 'Livraison' if m.movement_type == 'delivery' else 'Reprise' }}
            </div>
            <div class="bubble-body">
              <div class="bubble-title">
                <a href="{{ url_for('client_detail', client_id=m.client_id) }}">
                  {{ m.client.name if m.client and (m.client.name is defined) else ('Client #' ~ m.client_id) }}
                </a>
              </div>
              <div class="bubble-meta">
                {{ (m.qty or 0) }} Ã— {{ m.product or 'â€”' }}
                {% if m.keg_serial %} â€¢ FÃ»t {{ m.keg_serial }}{% endif %}
              </div>
              <div class="bubble-time">
                {{ m.created_at }}
              </div>
            </div>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">Pas dâ€™historique rÃ©cent.</p>
    {% endif %}
  </section>

  <section class="clients">
    <h2>ðŸ‘¥ Clients</h2>
    {% if clients and clients|length %}
      <ul class="client-grid">
        {% for c in clients %}
          <li class="client-card">
            <a href="{{ url_for('client_detail', client_id=c.id) }}">
              <div class="client-name">{{ c.name }}</div>
              {% if c.address %}<div class="client-sub">{{ c.address }}</div>{% endif %}
            </a>
          </li>
        {% endfor %}
      </ul>
    {% else %}
      <p class="muted">Aucun client pour le moment.</p>
    {% endif %}
  </section>
{% endblock %}

{% block extra_css %}
<style>
  .hero h1 { margin:0 }
  .muted { color:#777 }
  .bubbles { margin: 1rem 0 1.5rem 0 }
  .bubble-row { list-style:none; display:flex; gap:.75rem; padding:0; margin:0; overflow:auto }
  .bubble { border:1px solid #e5e5e5; background:#fff; border-radius:1rem; padding:.6rem .8rem; min-width:220px }
  .bubble-type { font-size:.75rem; font-weight:700; margin-bottom:.25rem; display:inline-block; padding:.1rem .4rem; border-radius:.5rem; border:1px solid #ddd }
  .bubble-type.is-delivery { background:#e9fbf4; border-color:#a6e8cf }
  .bubble-type.is-return { background:#f4f7ff; border-color:#c9d6ff }
  .bubble-title a { font-weight:700; text-decoration:none; color:#111 }
  .bubble-meta { color:#444; margin-top:.15rem }
  .bubble-time { color:#999; font-size:.8rem; margin-top:.15rem; white-space:nowrap }
  .clients { margin-top: 2rem }
  .client-grid { list-style:none; display:grid; gap:.75rem; padding:0; grid-template-columns: repeat(auto-fit, minmax(220px,1fr)); }
  .client-card { border:1px solid #eee; border-radius:.8rem; background:#fff }
  .client-card a { display:block; padding:.9rem .9rem; text-decoration:none; color:inherit }
  .client-name { font-weight:700 }
  .client-sub { color:#666; font-size:.9rem; margin-top:.1rem }
</style>
{% endblock %}
