{% extends "base.html" %}
{% import "_macros.html" as ui %}

{% block content %}
<div class="header-line">
  <h1>{{ c.name }}</h1>
  <div class="btn-group">
    <a class="btn btn-primary" href="{{ url_for('movement_new', client_id=c.id) }}">+ Nouveau mouvement</a>
    <a class="btn btn-outline-secondary" href="{{ url_for('client_edit', client_id=c.id) }}">Modifier</a>
    <a class="btn btn-outline-danger" href="{{ url_for('client_confirm_delete', client_id=c.id) }}">Supprimer</a>
  </div>
</div>

<div class="grid-2">
  <div class="card">
    <div class="card-header">Récapitulatif</div>
    <div class="card-body">
      <div class="pills">
        <span class="pill pill-muted">Fûts en jeu: {{ view.kegs_qty }}</span>
        <span class="pill">Consignes fûts: {{ ui.eur(view.deposits.keg_eur) }} ({{ view.deposits.keg_qty }} uds)</span>
        <span class="pill pill-cup">Consigne gobelets: {{ ui.eur(view.deposits.cup_eur) }} ({{ view.deposits.cup_qty }} uds)</span>
      </div>
      <div class="mt-2">
        <div><strong>Matériel prêté</strong></div>
        {{ ui.equipment_badges(view.equipment) }}
      </div>
      {% if c.notes %}
      <hr/>
      <div class="muted">Notes : {{ c.notes }}</div>
      {% endif %}
    </div>
  </div>

  <div class="card">
    <div class="card-header">Fûts en jeu (détail)</div>
    <div class="card-body">
      {% if view.open_by_variant %}
      <table class="table">
        <thead>
          <tr><th>Produit</th><th>Contenance</th><th class="ta-right">En jeu</th></tr>
        </thead>
        <tbody>
          {% for r in view.open_by_variant %}
          <tr>
            <td>{{ r.product_name }}</td>
            <td>{{ r.size_l }} L</td>
            <td class="ta-right"><strong>{{ r.qty_open }}</strong></td>
          </tr>
          {% endfor %}
        </tbody>
      </table>
      {% else %}
      <div class="muted">Aucun fût en jeu.</div>
      {% endif %}
    </div>
  </div>
</div>
{% endblock %}
