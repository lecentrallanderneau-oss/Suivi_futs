{% extends "base.html" %}
{% import "_macros.html" as ui %}

{% block content %}
  {# On supporte les deux conventions : 'c' ou 'client' #}
  {% set ctx = (c if (c is defined) else (client if (client is defined) else none)) %}

  <section class="page-header">
    <h1>
      {{ ctx.name if ctx else "Client" }}
    </h1>
    <p class="muted">
      ID :
      {{ ctx.id if (ctx and (ctx.id is defined)) else "—" }}
    </p>
    <p>
      <a href="{{ url_for('index') }}" class="btn">← Retour à l’accueil</a>
      {% if ctx and ctx.id is defined %}
        <a href="{{ url_for('client_edit', client_id=ctx.id) }}" class="btn btn-secondary">Modifier</a>
      {% endif %}
    </p>
  </section>

  <section class="grid">
    <div class="card">
      <h2>Contact</h2>
      <ul class="list">
        <li><strong>Nom</strong> : {{ ctx.name if ctx else "—" }}</li>
        <li><strong>Email</strong> : {{ ctx.email if (ctx and (ctx.email is defined)) else "—" }}</li>
        <li><strong>Téléphone</strong> : {{ ctx.phone if (ctx and (ctx.phone is defined)) else "—" }}</li>
        <li><strong>Adresse</strong> : {{ ctx.address if (ctx and (ctx.address is defined)) else "—" }}</li>
      </ul>
    </div>

    <div class="card">
      <h2>Fûts en circulation</h2>
      <p class="kpi">
        {{ keg_qty_in_play if (keg_qty_in_play is defined) else 0 }}
      </p>
    </div>
  </section>

  {# Sections optionnelles si les variables existent #}
  {% if deliveries is defined and deliveries %}
    <section class="card">
      <h2>Dernières livraisons</h2>
      <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>Produit</th>
            <th>Qté</th>
            <th>N° fût</th>
          </tr>
        </thead>
        <tbody>
          {% for d in deliveries %}
            <tr>
              <td>{{ d.date or "—" }}</td>
              <td>{{ d.product or "—" }}</td>
              <td>{{ d.qty or "—" }}</td>
              <td>{{ d.keg_serial or "—" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
  {% endif %}

  {% if returns is defined and returns %}
    <section class="card">
      <h2>Retours de fûts</h2>
      <table class="table">
        <thead>
          <tr>
            <th>Date</th>
            <th>N° fût</th>
            <th>État</th>
          </tr>
        </thead>
        <tbody>
          {% for r in returns %}
            <tr>
              <td>{{ r.date or "—" }}</td>
              <td>{{ r.keg_serial or "—" }}</td>
              <td>{{ r.status or "—" }}</td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </section>
  {% endif %}

  {% if balances is defined %}
    <section class="card">
      <h2>Solde client</h2>
      <ul class="list">
        <li><strong>Fûts sortis</strong> : {{ balances.out or 0 }}</li>
        <li><strong>Fûts rentrés</strong> : {{ balances.in or 0 }}</li>
        <li><strong>Solde courant</strong> : {{ balances.current or 0 }}</li>
      </ul>
    </section>
  {% endif %}
{% endblock %}
